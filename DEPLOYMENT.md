# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—é –Ω–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–µ–∑–∞–≤–∏—Å–∏–º –æ—Ç –æ–±–ª–∞—á–Ω–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã poehali.dev –∏ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç –Ω–∞ –ª—é–±–æ–º —Å–µ—Ä–≤–µ—Ä–µ —Å Python –∏ Node.js.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Nginx (80)    ‚îÇ  ‚Üê –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ                         ‚îÇ
    ‚ñº                         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Frontend   ‚îÇ      ‚îÇ  Backend Python  ‚îÇ
‚îÇ  (Vite)     ‚îÇ      ‚îÇ  (port 8000)     ‚îÇ
‚îÇ  —Å—Ç–∞—Ç–∏–∫–∞    ‚îÇ      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò               ‚îÇ
                              ‚ñº
                      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                      ‚îÇ  PostgreSQL   ‚îÇ
                      ‚îÇ  (TimeWeb)    ‚îÇ
                      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **–°–µ—Ä–≤–µ—Ä**: Ubuntu/Debian —Å root –¥–æ—Å—Ç—É–ø–æ–º
- **Python**: 3.9+
- **Node.js**: 18+
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: PostgreSQL (–Ω–∞–ø—Ä–∏–º–µ—Ä, TimeWeb Cloud)
- **Nginx**: –¥–ª—è –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤

## –®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞–∫–µ—Ç—ã
sudo apt update
sudo apt install -y python3 python3-pip python3-venv nginx nodejs npm git

# –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π (–∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —á–µ—Ä–µ–∑ GitHub)
git clone <–≤–∞—à-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π>
cd knowledge-management-system
```

## –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Backend (Python)

```bash
cd backend

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏
chmod +x setup.sh
./setup.sh

# –°–æ–∑–¥–∞–π—Ç–µ .env —Ñ–∞–π–ª —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
cp .env.example .env
nano .env

# –î–æ–±–∞–≤—å—Ç–µ —Å—Ç—Ä–æ–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –≤–∞—à–µ–π –ë–î TimeWeb:
# DATABASE_CONNECTION_TIMEWEB=postgresql://user:pass@host:port/db
```

**–¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫ backend:**
```bash
source venv/bin/activate
python3 run_local.py
```

–î–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è:
```
üöÄ Local backend server running on http://localhost:8000
Available endpoints:
  - /api/auth          -> backend/auth/
  - /api/db            -> backend/external-db/
  - /api/email         -> backend/email-notifications/
  - /api/password-reset -> backend/password-reset/
```

## –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Frontend

```bash
cd ..  # –í–µ—Ä–Ω–∏—Ç–µ—Å—å –≤ –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
npm install

# –°–æ–±–µ—Ä–∏—Ç–µ production build
npm run build

# –†–µ–∑—É–ª—å—Ç–∞—Ç –±—É–¥–µ—Ç –≤ –ø–∞–ø–∫–µ dist/
```

## –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Nginx

–°–æ–∑–¥–∞–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–µ–Ω–∞:

```bash
sudo nano /etc/nginx/sites-available/ab-education
```

–í—Å—Ç–∞–≤—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:

```nginx
server {
    listen 80;
    server_name ab-education.ru www.ab-education.ru;

    # Frontend —Å—Ç–∞—Ç–∏–∫–∞
    root /var/www/knowledge-management-system/dist;
    index index.html;

    # –°–∂–∞—Ç–∏–µ
    gzip on;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;

    # Frontend SPA –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è
    location / {
        try_files $uri $uri/ /index.html;
    }

    # Backend API –ø—Ä–æ–∫—Å–∏ –Ω–∞ Python —Å–µ—Ä–≤–µ—Ä
    location /api/ {
        proxy_pass http://localhost:8000;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # CORS –∑–∞–≥–æ–ª–æ–≤–∫–∏
        add_header Access-Control-Allow-Origin * always;
        add_header Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS" always;
        add_header Access-Control-Allow-Headers "Content-Type, X-User-Id, X-Auth-Token, X-Session-Id" always;
        
        # OPTIONS preflight
        if ($request_method = OPTIONS) {
            return 204;
        }
    }

    # –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏–∫–∏
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
```

**–ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:**

```bash
sudo ln -s /etc/nginx/sites-available/ab-education /etc/nginx/sites-enabled/
sudo nginx -t  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
sudo systemctl reload nginx
```

## –®–∞–≥ 5: –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ Backend (systemd)

–°–æ–∑–¥–∞–π—Ç–µ systemd service –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ Python backend:

```bash
sudo nano /etc/systemd/system/km-backend.service
```

–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:

```ini
[Unit]
Description=Knowledge Management Backend Server
After=network.target

[Service]
Type=simple
User=www-data
WorkingDirectory=/var/www/knowledge-management-system/backend
Environment="PATH=/var/www/knowledge-management-system/backend/venv/bin"
EnvironmentFile=/var/www/knowledge-management-system/backend/.env
ExecStart=/var/www/knowledge-management-system/backend/venv/bin/python3 /var/www/knowledge-management-system/backend/run_local.py
Restart=always
RestartSec=5

[Install]
WantedBy=multi-user.target
```

**–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å:**

```bash
sudo systemctl daemon-reload
sudo systemctl enable km-backend
sudo systemctl start km-backend
sudo systemctl status km-backend
```

## –®–∞–≥ 6: SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
sudo apt install certbot python3-certbot-nginx
sudo certbot --nginx -d ab-education.ru -d www.ab-education.ru
```

Certbot –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç HTTPS –∏ –¥–æ–±–∞–≤–∏—Ç —Ä–µ–¥–∏—Ä–µ–∫—Ç —Å HTTP.

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

1. **Frontend**: –û—Ç–∫—Ä–æ–π—Ç–µ http://ab-education.ru ‚Äî –¥–æ–ª–∂–Ω–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞
2. **Backend API**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ http://ab-education.ru/api/auth?action=check ‚Äî –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å JSON
3. **–õ–æ–≥–∏ Backend**: `sudo journalctl -u km-backend -f`
4. **–õ–æ–≥–∏ Nginx**: `sudo tail -f /var/log/nginx/error.log`

## –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

–ö–æ–≥–¥–∞ –≤—ã –æ–±–Ω–æ–≤–ª—è–µ—Ç–µ –∫–æ–¥ —á–µ—Ä–µ–∑ poehali.dev –∏ –ø—É—à–∏—Ç–µ –≤ GitHub:

```bash
cd /var/www/knowledge-management-system
git pull origin main

# –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ frontend
npm install
npm run build

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ backend (–µ—Å–ª–∏ –±—ã–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è)
sudo systemctl restart km-backend

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ nginx
sudo systemctl reload nginx
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ –ø–æ—Å–ª–µ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è

```
/var/www/knowledge-management-system/
‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îú‚îÄ‚îÄ venv/              # Python –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ .env               # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–ë–î)
‚îÇ   ‚îú‚îÄ‚îÄ run_local.py       # –õ–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä Python
‚îÇ   ‚îú‚îÄ‚îÄ auth/              # –§—É–Ω–∫—Ü–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ external-db/       # –§—É–Ω–∫—Ü–∏—è —Ä–∞–±–æ—Ç—ã —Å –ë–î
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ dist/                  # –°–æ–±—Ä–∞–Ω–Ω—ã–π frontend (nginx —Ä–∞–∑–¥–∞—ë—Ç –æ—Ç—Å—é–¥–∞)
‚îú‚îÄ‚îÄ src/                   # –ò—Å—Ö–æ–¥–Ω–∏–∫–∏ frontend
‚îî‚îÄ‚îÄ node_modules/          # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Node.js
```

## Troubleshooting

### Backend –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
sudo journalctl -u km-backend -n 50

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ .env —Ñ–∞–π–ª
cat backend/.env

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
psql "postgresql://user:pass@host:port/db"
```

### 502 Bad Gateway
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –∑–∞–ø—É—â–µ–Ω –ª–∏ backend
sudo systemctl status km-backend

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —Å–ª—É—à–∞–µ—Ç –ª–∏ –ø–æ—Ä—Ç 8000
sudo netstat -tulpn | grep 8000
```

### CORS –æ—à–∏–±–∫–∏
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
sudo nginx -t
sudo systemctl reload nginx
```

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä–æ–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤ `backend/.env`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ IP —Å–µ—Ä–≤–µ—Ä–∞ –¥–æ–±–∞–≤–ª–µ–Ω –≤ whitelist TimeWeb Cloud
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (–¥–æ–ª–∂–µ–Ω —Å–∫–∞—á–∞—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ)

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

```bash
# –°—Ç–∞—Ç—É—Å –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
sudo systemctl status km-backend nginx

# –õ–æ–≥–∏ Backend
sudo journalctl -u km-backend -f

# –õ–æ–≥–∏ Nginx
sudo tail -f /var/log/nginx/access.log
sudo tail -f /var/log/nginx/error.log

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
htop
```

---

**–ì–æ—Ç–æ–≤–æ!** –¢–µ–ø–µ—Ä—å –≤–∞—à –ø—Ä–æ–µ–∫—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–Ω–æ–º–Ω–æ –Ω–∞ –≤–∞—à–µ–º —Å–µ—Ä–≤–µ—Ä–µ –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç poehali.dev. üöÄ
